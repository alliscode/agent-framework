<#@ template language="C#" inherits="PythonCodeTemplate" visibility="internal" linePragmas="false" #>
<#@ import namespace="Microsoft.Agents.AI.Workflows.Declarative.Extensions" #>
<#@ assembly name="System.Core" #>
# ------------------------------------------------------------------------------
# <auto-generated>
#     This code was generated by a tool.
# </auto-generated>
# ------------------------------------------------------------------------------

from typing import Callable, Optional, TypeVar, List
from datetime import datetime, timedelta
from agents.workflows import (
    Workflow, WorkflowBuilder, RootExecutor, ActionExecutor,
    AgentExecutor, DelegateExecutor, FormulaSession
)
from agents.workflows.declarative import DeclarativeWorkflowOptions
from extensions.ai import ChatMessage, ChatRole, AgentRunResponse, AgentRunResponseEvent
import asyncio

TInput = TypeVar('TInput')
<#
if (this.Namespace is not null)
{#>

# Module: <#= this.Namespace #>
<#
}
#>

class <#= this.Prefix ?? string.Empty #>WorkflowProvider:
    """
    This class provides a factory method to create a Workflow instance.

    The workflow defined here was generated from a declarative workflow definition.
    Declarative workflows utilize Power FX for defining conditions and expressions.
    To learn more about Power FX, see:
    https://learn.microsoft.com/power-platform/power-fx/formula-reference-copilot-studio
    """
<#
foreach (string executor in ByLine(this.Executors, formatGroup: true))
{ #>
    <#= executor #><#
}
#>

    @staticmethod
    def create_workflow(
        options: DeclarativeWorkflowOptions,
        input_transform: Optional[Callable[[TInput], ChatMessage]] = None
    ) -> Workflow:
        """Create and configure the workflow with all executors and edges."""
        # Create root executor to initialize the workflow
        if input_transform is None:
            input_transform = lambda message: DeclarativeWorkflowBuilder.default_transform(message)

        <#= this.RootInstance #> = <#= this.RootExecutorType #>Executor(options=options, input_transform=input_transform)
<#
        // Create executor instances
foreach (string instance in ByLine(this.Instances))
{ #>
        <#= instance #><#
}#>

        # Define the workflow builder
        builder = WorkflowBuilder(root_executor=<#= this.RootInstance #>)

        # Connect executors<#
foreach (string edge in ByLine(this.Edges))
{ #>
        <#= edge #><#
}
 #>

        # Build the workflow
        return builder.build()
